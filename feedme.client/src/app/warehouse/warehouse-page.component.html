<div class="warehouse-page">
  <aside class="warehouse-page__sidebar">
    <div class="warehouse-page__brand">Rest.Name</div>

    <nav class="warehouse-page__primary-nav">
      <span class="warehouse-page__primary-link warehouse-page__primary-link--active">Склад</span>
      <a class="warehouse-page__primary-link" href="javascript:void(0)">Заказы</a>
      <a class="warehouse-page__primary-link" href="javascript:void(0)">Касса</a>
      <a class="warehouse-page__primary-link" href="javascript:void(0)">Аналитика</a>
      <a class="warehouse-page__primary-link" href="javascript:void(0)">Настройки</a>
    </nav>

    <div class="warehouse-page__divider" aria-hidden="true"></div>

    <section class="warehouse-page__locations">
      <h2 class="warehouse-page__locations-title">Склады</h2>
      <span class="warehouse-page__location warehouse-page__location--active">Главный склад</span>
      <a class="warehouse-page__location" href="javascript:void(0)">Кухня</a>
      <a class="warehouse-page__location" href="javascript:void(0)">Бар</a>
      <a class="warehouse-page__location" href="javascript:void(0)">Холодильник</a>
    </section>
  </aside>

  <main class="warehouse-page__content">
    <div class="warehouse-page__tabs-wrapper">
      <div class="primary-tabs" role="tablist" aria-label="Разделы склада">
        <button
          type="button"
          class="primary-tab"
          role="tab"
          [id]="'warehouse-tab-button-' + 'supplies'"
          [class.primary-tab--active]="activeTab() === 'supplies'"
          [attr.aria-selected]="activeTab() === 'supplies'"
          [attr.aria-controls]="'warehouse-tab-panel-' + 'supplies'"
          (click)="selectTab('supplies')"
        >
          Поставки
        </button>
        <button
          type="button"
          class="primary-tab"
          role="tab"
          [id]="'warehouse-tab-button-' + 'stock'"
          [class.primary-tab--active]="activeTab() === 'stock'"
          [attr.aria-selected]="activeTab() === 'stock'"
          [attr.aria-controls]="'warehouse-tab-panel-' + 'stock'"
          (click)="selectTab('stock')"
        >
          Остатки
        </button>
        <button
          type="button"
          class="primary-tab"
          role="tab"
          [id]="'warehouse-tab-button-' + 'catalog'"
          [class.primary-tab--active]="activeTab() === 'catalog'"
          [attr.aria-selected]="activeTab() === 'catalog'"
          [attr.aria-controls]="'warehouse-tab-panel-' + 'catalog'"
          (click)="selectTab('catalog')"
        >
          Каталог
        </button>
        <button
          type="button"
          class="primary-tab"
          role="tab"
          [id]="'warehouse-tab-button-' + 'inventory'"
          [class.primary-tab--active]="activeTab() === 'inventory'"
          [attr.aria-selected]="activeTab() === 'inventory'"
          [attr.aria-controls]="'warehouse-tab-panel-' + 'inventory'"
          (click)="selectTab('inventory')"
        >
          Инвентаризация
        </button>
        <span class="indicator" aria-hidden="true"></span>
      </div>
    </div>

    <header class="header-crumbs">
      <nav class="breadcrumbs" aria-label="Хлебные крошки">
        <span>Поставки</span>
        <span class="sep" aria-hidden="true">/</span>
        <span>{{ selectedWarehouse() || 'Все склады' }}</span>
      </nav>
    </header>

    <ng-container *ngIf="activeTab() === 'supplies'">
      <section
        *ngIf="overviewMetrics() as snapshot"
        class="kpis"
        aria-label="Ключевые показатели склада"
      >
        <article class="card" aria-live="polite">
          <p class="card__title">Поставок за 7 дней</p>
          <p class="card__value">{{ snapshot.suppliesLastWeek }}</p>
        </article>
        <article class="card" aria-live="polite">
          <p class="card__title">Сумма закупок / 7 дн.</p>
          <p class="card__value">{{ formatCurrency(snapshot.purchaseAmountLastWeek) }}</p>
        </article>
        <article class="card" aria-live="polite">
          <p class="card__title">Позиций на складе</p>
          <p class="card__value">{{ snapshot.positions }}</p>
        </article>
        <article class="card" aria-live="polite">
          <p class="card__title">Просрочено</p>
          <p class="card__value" [ngClass]="{ neg: snapshot.expired > 0 }">{{ snapshot.expired }}</p>
        </article>
      </section>

      <app-supply-table
        [data]="supplyTableData()"
        (onAddSupply)="openCreateDialog()"
        (onSettingsClick)="handleSupplySettings($event)"
        (writeOff)="handleSupplyWriteOff($event)"
        (move)="handleSupplyMove($event)"
        (print)="handleSupplyPrint($event)"
      ></app-supply-table>
    </ng-container>

    <section
      *ngIf="activeTab() === 'stock'"
      class="warehouse-page__tab-panel"
      role="tabpanel"
      id="warehouse-tab-panel-stock"
      [attr.aria-labelledby]="'warehouse-tab-button-' + 'stock'"
    >
      <app-empty title="Остатки" subtitle="Выберите склад и примените фильтры"></app-empty>
    </section>

    <section
      *ngIf="activeTab() === 'catalog'"
      class="warehouse-page__tab-panel"
      role="tabpanel"
      id="warehouse-tab-panel-catalog"
      [attr.aria-labelledby]="'warehouse-tab-button-' + 'catalog'"
    >
      <app-catalog [searchQuery]="search()"></app-catalog>
    </section>

    <section
      *ngIf="activeTab() === 'inventory'"
      class="warehouse-page__tab-panel"
      role="tabpanel"
      id="warehouse-tab-panel-inventory"
      [attr.aria-labelledby]="'warehouse-tab-button-' + 'inventory'"
    >
      <app-inventory
        [warehouseFilter]="selectedWarehouse()"
        [searchFilter]="search()"
        [dateFrom]="dateFrom()"
        [dateTo]="dateTo()"
      ></app-inventory>
    </section>
  </main>

  <div class="warehouse-page__dialog-backdrop" *ngIf="createDialogOpen()">
    <app-create-supply-dialog
      (cancel)="closeCreateDialog()"
      (create)="handleCreateSupply($event)"
    ></app-create-supply-dialog>
  </div>
</div>

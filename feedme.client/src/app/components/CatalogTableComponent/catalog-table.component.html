<!-- Заголовок: поиск + выбор числа строк -->
<div class="table-header">
  <app-table-controls [searchQuery]="searchQuery"
                      [rowsPerPage]="rowsPerPage"
                      (searchQueryChange)="onSearchChange($event)"
                      (rowsPerPageChange)="onRowsChange($event)">
  </app-table-controls>
  <app-catalog-view-switcher [view]="viewMode" (viewChange)="onViewChange($event)"></app-catalog-view-switcher>
  <button class="add-button" (click)="addSupply()">+ Новый товар</button>

</div>

<!-- Горизонтальный скролл для таблицы -->
<div class="table-container">
  <table class="catalog-table">
    <thead>
      <tr>
        <th
          *ngFor="let column of columns"
          scope="col"
          [attr.id]="getHeaderId(column)"
          [ngClass]="getHeaderClasses(column)"
          (click)="column.sortable === false ? null : onSort(column.key)"
        >
          <span>{{ column.label }}</span>
          <span class="ind" *ngIf="column.sortable !== false"></span>
        </th>
        <th
          class="w-actions"
          scope="col"
          [attr.id]="actionsHeaderId"
        >
          Действия
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of paginatedData">
        <td
          *ngFor="let column of columns"
          [attr.headers]="getHeaderId(column)"
          [ngClass]="getCellClasses(column)"
        >
          <ng-container [ngSwitch]="column.key">
            <span
              *ngSwitchCase="'name'"
              class="text-clip"
              [title]="format(item.name)"
            >
              {{ format(item.name) }}
            </span>
            <span
              *ngSwitchCase="'type'"
              class="text-clip"
              [title]="format(item.type)"
            >
              {{ format(item.type) }}
            </span>
            <span
              *ngSwitchCase="'code'"
              class="mono"
              [title]="format(item.code)"
            >
              {{ format(item.code) }}
            </span>
            <span
              *ngSwitchCase="'category'"
              class="text-clip"
              [title]="format(item.category)"
            >
              {{ format(item.category) }}
            </span>
            <span
              *ngSwitchCase="'unit'"
              class="mono"
              [title]="format(item.unit)"
            >
              {{ format(item.unit) }}
            </span>
            <span *ngSwitchCase="'writeoffMethod'" class="pill" [ngClass]="getWriteoffPillClass(item.writeoffMethod)">
              {{ format(item.writeoffMethod) }}
            </span>
            <span
              *ngSwitchCase="'allergens'"
              class="text-clip"
              [title]="format(item.allergens)"
            >
              {{ format(item.allergens) }}
            </span>
            <ng-container *ngSwitchCase="'packagingRequired'">
              <ng-container *ngIf="getFlagLabels(item) as flags">
                <div class="flags" *ngIf="flags.length > 0; else noFlags">
                  <span class="flag" *ngFor="let flag of flags">{{ flag }}</span>
                </div>
                <ng-template #noFlags>
                  <span class="flag flag-empty">Нет флагов</span>
                </ng-template>
              </ng-container>
            </ng-container>
            <span
              *ngSwitchCase="'supplier'"
              class="text-clip"
              [title]="format(item.supplier)"
            >
              {{ format(item.supplier) }}
            </span>
            <span
              *ngSwitchCase="'costEstimate'"
              class="mono"
            >
              {{ format(item.costEstimate) }}
            </span>
            <span *ngSwitchCase="'taxRate'" class="mono">
              {{ format(item.taxRate) }}
            </span>
            <span *ngSwitchCase="'unitPrice'" class="mono">
              {{ format(item.unitPrice) }}
            </span>
            <span *ngSwitchCase="'tnved'" class="mono" [title]="format(item.tnved)">
              {{ format(item.tnved) }}
            </span>
            <span *ngSwitchCase="'isMarked'" class="pill" [class.pill-green]="item.isMarked">
              {{ item.isMarked ? 'Да' : 'Нет' }}
            </span>
            <span *ngSwitchCase="'isAlcohol'" class="pill" [class.pill-green]="item.isAlcohol">
              {{ item.isAlcohol ? 'Да' : 'Нет' }}
            </span>
            <span *ngSwitchDefault [title]="format(item[column.key])">
              {{ format(item[column.key]) }}
            </span>
          </ng-container>
        </td>
        <td
          class="w-actions actions-cell"
          [attr.headers]="actionsHeaderId"
        >
          <button class="btn-icon" type="button" aria-label="Редактировать" (click)="edit.emit(item)">
            <img src="assets/correct.svg" alt="Редактировать" />
          </button>
          <button class="btn-icon" type="button" aria-label="Удалить" (click)="requestDelete(item)">
            <img src="assets/delete.svg" alt="Удалить" />
          </button>
        </td>
      </tr>
      <tr *ngIf="paginatedData.length === 0">
        <td [attr.colspan]="columns.length + 1" class="no-data">Нет данных</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Пагинация -->
<div class="pagination-controls">
  <button (click)="prevPage()" [disabled]="currentPage === 1">Назад</button>
  <span>Страница {{ currentPage }} из {{ totalPages }}</span>
  <button (click)="nextPage()" [disabled]="currentPage === totalPages">Далее</button>
</div>

<app-confirm-delete-popup
  *ngIf="showConfirm"
  (confirm)="confirmDelete()"
  (cancel)="cancelDelete()">
</app-confirm-delete-popup>

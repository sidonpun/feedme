<div class="card supplies-filters">
  <div class="card__content p-4 flex flex-wrap items-center gap-3">
    <label class="filters-control filters-control--search">
      <span class="filters-control__label">Поиск</span>
      <input
        type="search"
        class="input w-[320px]"
        placeholder="Поиск по номеру, SKU или названию"
        aria-label="Поиск по поставкам"
        [value]="searchQuery"
        #searchInput
        (input)="onSearchChange(searchInput.value)"
      />
    </label>

    <label class="filters-control">
      <span class="filters-control__label">Дата от</span>
      <input type="date" class="input w-[160px]" aria-label="Дата прихода от" />
    </label>

    <label class="filters-control">
      <span class="filters-control__label">Дата до</span>
      <input type="date" class="input w-[160px]" aria-label="Дата прихода до" />
    </label>

    <button type="button" class="btn btn-outline">Сброс</button>
    <button type="button" class="btn btn-brand-outline">Импорт</button>
    <button type="button" class="btn btn-secondary">Экспорт</button>
    <button type="button" class="btn btn-primary ml-auto" (click)="addSupply()">+ Новая поставка</button>
  </div>
</div>

<div class="table-container">
  <table class="supplies-table">
    <thead class="supplies-table__head sticky top-0 bg-background/90 backdrop-blur border-b shadow-[inset_0_-1px_0_0_var(--border)]">
      <tr class="h-11 align-middle">
        <th class="w-[40px]" scope="col">
          <input type="checkbox" class="checkbox" aria-label="Выбрать все поставки" />
        </th>
        <th scope="col" class="text-sm font-medium" title="Номер приходного документа">№ док.</th>
        <th scope="col" class="text-sm font-medium">Дата прихода</th>
        <th scope="col" class="text-sm font-medium">Склад</th>
        <th scope="col" class="text-sm font-medium">Ответственный</th>
        <th scope="col" class="text-sm font-medium">SKU</th>
        <th scope="col" class="text-sm font-medium">Название</th>
        <th scope="col" class="text-sm font-medium text-right" title="Количество в базовой ед. изм.">Кол-во</th>
        <th scope="col" class="text-sm font-medium text-center" title="Дата, после которой товар списывается">Срок годности</th>
        <th scope="col" class="text-sm font-medium">Поставщик</th>
        <th scope="col" class="text-sm font-medium">Статус</th>
        <th scope="col" class="w-[176px] text-right">
          <span class="sr-only">Быстрые действия</span>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of paginatedData" class="hover:bg-muted/40 odd:bg-muted/10 h-11 align-middle">
        <td class="w-[40px]">
          <input type="checkbox" class="checkbox" aria-label="Выбрать поставку" />
        </td>
        <td class="font-mono text-xs">
          {{ item.documentNumber || item.id || '—' }}
        </td>
        <td class="text-center">
          {{ item.arrivalDate || item.createdAt || item.date || '—' }}
        </td>
        <td>
          <span class="truncate" [title]="item.warehouse || item.location || '—'">
            {{ item.warehouse || item.location || '—' }}
          </span>
        </td>
        <td>
          <span class="truncate" [title]="item.responsible || item.manager || '—'">
            {{ item.responsible || item.manager || '—' }}
          </span>
        </td>
        <td class="font-mono text-xs">
          {{ item.sku || item.code || '—' }}
        </td>
        <td>
          <span class="truncate" [title]="item.productName || item.name || '—'">
            {{ item.productName || item.name || '—' }}
          </span>
        </td>
        <td class="text-right">
          {{ (item.stock ?? item.quantity ?? '—') }}
        </td>
        <td class="text-center">
          {{ item.expiryDate ? (item.expiryDate | date: 'dd.MM.yyyy') : '—' }}
        </td>
        <td>
          <span class="truncate" [title]="item.supplier || item.vendor || '—'">
            {{ item.supplier || item.vendor || '—' }}
          </span>
        </td>
        <td>
          <ng-container *ngIf="(item.status || item.state || 'Ок') as status">
            <span
              class="badge min-w-[88px] justify-center"
              [ngClass]="status | statusBadgeClass"
            >
              {{ status | statusBadgeLabel }}
            </span>
          </ng-container>
        </td>
        <td class="row-actions">
          <button
            type="button"
            class="icon-btn"
            aria-label="Списать"
            (click)="writeOff.emit(item)"
          >
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M4 6h16"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
              />
              <path
                d="M10 11v6m4-6v6M6 6l1 12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-12M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
              />
            </svg>
          </button>
          <button
            type="button"
            class="icon-btn"
            aria-label="Переместить"
            (click)="move.emit(item)"
          >
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M7.5 8.5 4 12l3.5 3.5M4 12h9m3.5-7.5L20 8l-3.5 3.5M20 8H11"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
              />
            </svg>
          </button>
          <button
            type="button"
            class="icon-btn"
            aria-label="Печать"
            (click)="print.emit(item)"
          >
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M7 9V4h10v5M7 17H5a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-2"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
              />
              <path
                d="M8 17h8v5H8z"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
              />
              <path
                d="M17 13h.01"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
              />
            </svg>
          </button>
          <button type="button" class="icon-btn" aria-label="Меню" (click)="onSettingsClick.emit(item)">
            ⋯
          </button>
        </td>
      </tr>
      <tr *ngIf="paginatedData.length === 0">
        <td colspan="12" class="no-data">Нет данных</td>
      </tr>
    </tbody>
  </table>
</div>

<app-empty
  *ngIf="!hasAnySupply"
  class="mt-6 block"
  title="Нет поставок"
  subtitle="Создайте первую поставку, чтобы увидеть её в списке."
  ctaText="+ Новая поставка"
></app-empty>

<div class="table-footer flex items-center p-3 border-t text-sm bg-muted/40 shadow-sm">
  <div class="table-footer__summary">
    <span class="table-footer__summary-text text-muted-foreground">
      Показано {{ paginatedData.length }} поставок · Страница {{ currentPage }} из {{ totalPages }}
    </span>
    <span class="table-footer__total font-medium">Итог по сумме: 0 ₽</span>
  </div>
  <div class="ml-auto flex gap-2">
    <button type="button" class="btn btn-outline btn-sm" (click)="prevPage()" [disabled]="currentPage === 1">
      Назад
    </button>
    <button type="button" class="btn btn-outline btn-sm" (click)="nextPage()" [disabled]="currentPage === totalPages">
      Далее
    </button>
  </div>
</div>
